// Script de test pour v√©rifier les am√©liorations
const { frenchUtils } = require('./src/utils/letterGenerator');

console.log('üß™ Test des am√©liorations du g√©n√©rateur de lettres de motivation\n');

// Test des apostrophes
console.log('üìù Test des apostrophes:');
console.log('la exp√©rience ->', frenchUtils.addApostrophes('la exp√©rience'));
console.log('de innovation ->', frenchUtils.addApostrophes('de innovation'));
console.log('le entreprise ->', frenchUtils.addApostrophes('le entreprise'));
console.log('√† organisation ->', frenchUtils.addApostrophes('√† organisation'));

// Test des accords de genre
console.log('\nüë• Test des accords de genre:');
console.log('passionn√© (m) ->', frenchUtils.genderAgreement('passionn√©', 'male'));
console.log('passionn√© (f) ->', frenchUtils.genderAgreement('passionn√©', 'female'));
console.log('√©tudiant (m) ->', frenchUtils.genderAgreement('√©tudiant', 'male'));
console.log('√©tudiant (f) ->', frenchUtils.genderAgreement('√©tudiant', 'female'));

// Test des conjugaisons
console.log('\nüî§ Test des conjugaisons:');
console.log('√™tre (je) ->', frenchUtils.conjugatePresent('√™tre', 'je'));
console.log('avoir (je) ->', frenchUtils.conjugatePresent('avoir', 'je'));
console.log('pouvoir (je) ->', frenchUtils.conjugatePresent('pouvoir', 'je'));

// Test du formatage des listes
console.log('\nüìã Test du formatage des listes:');
console.log('1 √©l√©ment:', frenchUtils.formatNaturalList(['informatique']));
console.log('2 √©l√©ments:', frenchUtils.formatNaturalList(['informatique', 'math√©matiques']));
console.log('3 √©l√©ments:', frenchUtils.formatNaturalList(['informatique', 'math√©matiques', 'physique']));

// Test d'application des accords sur un texte complet
console.log('\nüìÑ Test d\'application des accords sur un texte:');
const sampleText = 'Je suis passionn√©e par l\'informatique et je suis une √©tudiante motiv√©e.';
console.log('Texte original:', sampleText);
console.log('Texte masculin:', frenchUtils.applyGenderAgreements(sampleText, 'male'));
console.log('Texte f√©minin:', frenchUtils.applyGenderAgreements(sampleText, 'female'));

console.log('\n‚úÖ Tests termin√©s !');

// Tests complets pour le g√©n√©rateur de lettres de motivation
// Test de tous les cas possibles

import { generateLocalLetter } from './src/utils/letterGenerator.js';

// Configuration de test compl√®te
const testCases = [
    // Test 1: Cas de base - aucune s√©lection
    {
        name: "Test 1: Cas de base - aucune s√©lection",
        formData: {
            name: "Marie Dupont",
            age: "22",
            target: "Stage en marketing",
            languages: "",
            interests: "",
            goals: "",
            motivation: "",
            achievements: "",
            experience: "",
            qualifications: ""
        },
        gender: "female",
        language: "fr"
    },

    // Test 2: Toutes les s√©lections en fran√ßais (f√©minin)
    {
        name: "Test 2: Toutes les s√©lections en fran√ßais (f√©minin)",
        formData: {
            name: "Sophie Martin",
            age: "24",
            target: "Poste de d√©veloppeuse",
            languages: "fran√ßais, anglais, espagnol",
            interests: "lecture, technologie, sport",
            goals: "d√©veloppement professionnel, innovation",
            motivation: "d√©fis intellectuels, travail d'√©quipe",
            achievements: "projet r√©ussi, prix acad√©mique",
            experience: "stage, projet personnel",
            qualifications: "dipl√¥me, comp√©tences techniques"
        },
        gender: "female",
        language: "fr"
    },

    // Test 3: Toutes les s√©lections en fran√ßais (masculin)
    {
        name: "Test 3: Toutes les s√©lections en fran√ßais (masculin)",
        formData: {
            name: "Pierre Dubois",
            age: "23",
            target: "Poste d'ing√©nieur",
            languages: "fran√ßais, anglais, allemand",
            interests: "musique, cin√©ma, cuisine",
            goals: "apprentissage continu, leadership",
            motivation: "innovation, impact social",
            achievements: "leadership, collaboration",
            experience: "travail √©tudiant, b√©n√©volat",
            qualifications: "certification, soft skills"
        },
        gender: "male",
        language: "fr"
    },

    // Test 4: S√©lections partielles en fran√ßais
    {
        name: "Test 4: S√©lections partielles en fran√ßais",
        formData: {
            name: "Emma Rousseau",
            age: "21",
            target: "Stage en communication",
            languages: "fran√ßais, anglais",
            interests: "√©criture, art",
            goals: "",
            motivation: "d√©veloppement personnel",
            achievements: "",
            experience: "aucune exp√©rience",
            qualifications: "passion"
        },
        gender: "female",
        language: "fr"
    },

    // Test 5: Cas de base en anglais
    {
        name: "Test 5: Cas de base en anglais",
        formData: {
            name: "John Smith",
            age: "25",
            target: "Software Engineer position",
            languages: "",
            interests: "",
            goals: "",
            motivation: "",
            achievements: "",
            experience: "",
            qualifications: ""
        },
        gender: "male",
        language: "en"
    },

    // Test 6: Toutes les s√©lections en anglais
    {
        name: "Test 6: Toutes les s√©lections en anglais",
        formData: {
            name: "Sarah Johnson",
            age: "26",
            target: "Marketing Manager position",
            languages: "English, French, Spanish",
            interests: "reading, traveling, photography",
            goals: "professional development, continuous learning",
            motivation: "intellectual challenges, teamwork",
            achievements: "successful project, academic award",
            experience: "internship, personal project",
            qualifications: "degree, technical skills"
        },
        gender: "female",
        language: "en"
    },

    // Test 7: Test des accords de genre - f√©minin
    {
        name: "Test 7: Test des accords de genre - f√©minin",
        formData: {
            name: "Claire Moreau",
            age: "22",
            target: "Poste de consultante",
            languages: "fran√ßais",
            interests: "lecture",
            goals: "d√©veloppement professionnel",
            motivation: "excellence",
            achievements: "projet r√©ussi",
            experience: "stage",
            qualifications: "dipl√¥me"
        },
        gender: "female",
        language: "fr"
    },

    // Test 8: Test des accords de genre - masculin
    {
        name: "Test 8: Test des accords de genre - masculin",
        formData: {
            name: "Thomas Bernard",
            age: "24",
            target: "Poste de consultant",
            languages: "fran√ßais",
            interests: "lecture",
            goals: "d√©veloppement professionnel",
            motivation: "excellence",
            achievements: "projet r√©ussi",
            experience: "stage",
            qualifications: "dipl√¥me"
        },
        gender: "male",
        language: "fr"
    },

    // Test 9: Test sans genre sp√©cifi√©
    {
        name: "Test 9: Test sans genre sp√©cifi√©",
        formData: {
            name: "Alex Taylor",
            age: "23",
            target: "Data Analyst position",
            languages: "English, French",
            interests: "technology, sports",
            goals: "technical expertise",
            motivation: "innovation",
            achievements: "leadership",
            experience: "internship",
            qualifications: "certification"
        },
        gender: "",
        language: "en"
    },

    // Test 10: Test avec une seule s√©lection de chaque type
    {
        name: "Test 10: Test avec une seule s√©lection de chaque type",
        formData: {
            name: "Lucas Petit",
            age: "20",
            target: "Stage en finance",
            languages: "anglais",
            interests: "sport",
            goals: "collaboration",
            motivation: "apprentissage",
            achievements: "communication",
            experience: "projet acad√©mique",
            qualifications: "langues"
        },
        gender: "male",
        language: "fr"
    },

    // Test 11: Test avec des s√©lections multiples (plus de 3)
    {
        name: "Test 11: Test avec des s√©lections multiples (plus de 3)",
        formData: {
            name: "Camille Leroy",
            age: "25",
            target: "Poste de chef de projet",
            languages: "fran√ßais, anglais, espagnol, allemand, italien",
            interests: "lecture, voyage, sport, musique, cin√©ma, cuisine",
            goals: "d√©veloppement professionnel, apprentissage continu, contribution sociale, innovation",
            motivation: "d√©fis intellectuels, travail d'√©quipe, innovation, apprentissage",
            achievements: "projet r√©ussi, prix acad√©mique, leadership, innovation",
            experience: "stage, projet personnel, travail √©tudiant, b√©n√©volat",
            qualifications: "dipl√¥me, certification, comp√©tences techniques, soft skills"
        },
        gender: "female",
        language: "fr"
    },

    // Test 12: Test avec des champs vides et des espaces
    {
        name: "Test 12: Test avec des champs vides et des espaces",
        formData: {
            name: "   Jean   Durand   ",
            age: "  23  ",
            target: "  Poste de d√©veloppeur  ",
            languages: "  fran√ßais  ,  anglais  ",
            interests: "  lecture  ,  sport  ",
            goals: "  ",
            motivation: "  d√©fis intellectuels  ",
            achievements: "  ",
            experience: "  stage  ",
            qualifications: "  dipl√¥me  "
        },
        gender: "male",
        language: "fr"
    },

    // Test 13: Test avec des caract√®res sp√©ciaux
    {
        name: "Test 13: Test avec des caract√®res sp√©ciaux",
        formData: {
            name: "Jos√© Garc√≠a",
            age: "24",
            target: "Poste d'ing√©nieur en IA",
            languages: "fran√ßais, anglais, espagnol",
            interests: "technologie, art, nature",
            goals: "innovation, impact positif",
            motivation: "d√©fis intellectuels, excellence",
            achievements: "projet r√©ussi, r√©solution de probl√®mes",
            experience: "projet personnel, formation",
            qualifications: "comp√©tences techniques, passion"
        },
        gender: "male",
        language: "fr"
    },

    // Test 14: Test de d√©tection automatique de langue (fran√ßais)
    {
        name: "Test 14: Test de d√©tection automatique de langue (fran√ßais)",
        formData: {
            name: "Marie-Claire Dubois",
            age: "22",
            target: "Stage √† Paris",
            languages: "fran√ßais, anglais",
            interests: "lecture, cuisine",
            goals: "d√©veloppement professionnel",
            motivation: "travail d'√©quipe",
            achievements: "projet r√©ussi",
            experience: "stage",
            qualifications: "dipl√¥me"
        },
        gender: "female",
        language: "fr"
    },

    // Test 15: Test de d√©tection automatique de langue (anglais)
    {
        name: "Test 15: Test de d√©tection automatique de langue (anglais)",
        formData: {
            name: "Michael Brown",
            age: "25",
            target: "Position in New York",
            languages: "English, French",
            interests: "reading, sports",
            goals: "professional development",
            motivation: "teamwork",
            achievements: "successful project",
            experience: "internship",
            qualifications: "degree"
        },
        gender: "male",
        language: "en"
    }
];

// Fonction de test
function runTests() {
    console.log("üöÄ D√âBUT DES TESTS COMPLETS DU G√âN√âRATEUR DE LETTRES\n");
    
    let passedTests = 0;
    let totalTests = testCases.length;
    
    testCases.forEach((testCase, index) => {
        console.log(`\nüìã ${testCase.name}`);
        console.log("‚îÄ".repeat(50));
        
        try {
            const result = generateLocalLetter(testCase.formData, testCase.language, testCase.gender);
            
            // V√©rifications de base
            const checks = [];
            
            // V√©rifier que la lettre contient le nom
            if (result.includes(testCase.formData.name.trim())) {
                checks.push("‚úÖ Nom int√©gr√©");
            } else {
                checks.push("‚ùå Nom manquant");
            }
            
            // V√©rifier que la lettre contient l'√¢ge
            if (testCase.formData.age && result.includes(testCase.formData.age.trim())) {
                checks.push("‚úÖ √Çge int√©gr√©");
            } else if (!testCase.formData.age) {
                checks.push("‚úÖ √Çge non requis");
            } else {
                checks.push("‚ùå √Çge manquant");
            }
            
            // V√©rifier que la lettre contient la cible
            if (result.includes(testCase.formData.target.trim())) {
                checks.push("‚úÖ Cible int√©gr√©e");
            } else {
                checks.push("‚ùå Cible manquante");
            }
            
            // V√©rifier les langues s√©lectionn√©es
            if (testCase.formData.languages) {
                const languages = testCase.formData.languages.split(',').map(l => l.trim()).filter(l => l);
                const hasLanguages = languages.some(lang => {
                    const langLower = lang.toLowerCase();
                    return result.toLowerCase().includes(langLower) || 
                           (langLower === 'fran√ßais' && result.toLowerCase().includes('fran√ßais')) ||
                           (langLower === 'anglais' && result.toLowerCase().includes('anglais')) ||
                           (langLower === 'english' && result.toLowerCase().includes('english')) ||
                           (langLower === 'french' && result.toLowerCase().includes('french'));
                });
                if (hasLanguages) {
                    checks.push("‚úÖ Langues int√©gr√©es");
                } else {
                    checks.push("‚ùå Langues manquantes");
                }
            } else {
                checks.push("‚úÖ Langues non requises");
            }
            
            // V√©rifier les int√©r√™ts s√©lectionn√©s
            if (testCase.formData.interests) {
                const interests = testCase.formData.interests.split(',').map(i => i.trim()).filter(i => i);
                const hasInterests = interests.some(interest => {
                    const interestLower = interest.toLowerCase();
                    return result.toLowerCase().includes(interestLower) ||
                           (interestLower === 'lecture' && result.toLowerCase().includes('lecture')) ||
                           (interestLower === 'reading' && result.toLowerCase().includes('reading')) ||
                           (interestLower === 'sport' && result.toLowerCase().includes('sport')) ||
                           (interestLower === 'sports' && result.toLowerCase().includes('sports'));
                });
                if (hasInterests) {
                    checks.push("‚úÖ Int√©r√™ts int√©gr√©s");
                } else {
                    checks.push("‚ùå Int√©r√™ts manquants");
                }
            } else {
                checks.push("‚úÖ Int√©r√™ts non requis");
            }
            
            // V√©rifier les objectifs s√©lectionn√©s
            if (testCase.formData.goals) {
                const goals = testCase.formData.goals.split(',').map(g => g.trim()).filter(g => g);
                const hasGoals = goals.some(goal => {
                    const goalLower = goal.toLowerCase();
                    return result.toLowerCase().includes(goalLower) ||
                           (goalLower === 'd√©veloppement professionnel' && result.toLowerCase().includes('d√©veloppement')) ||
                           (goalLower === 'professional development' && result.toLowerCase().includes('development'));
                });
                if (hasGoals) {
                    checks.push("‚úÖ Objectifs int√©gr√©s");
                } else {
                    checks.push("‚ùå Objectifs manquants");
                }
            } else {
                checks.push("‚úÖ Objectifs non requis");
            }
            
            // V√©rifier les motivations s√©lectionn√©es
            if (testCase.formData.motivation) {
                const motivations = testCase.formData.motivation.split(',').map(m => m.trim()).filter(m => m);
                const hasMotivations = motivations.some(motivation => {
                    const motLower = motivation.toLowerCase();
                    return result.toLowerCase().includes(motLower) ||
                           (motLower === 'd√©fis intellectuels' && result.toLowerCase().includes('d√©fis')) ||
                           (motLower === 'intellectual challenges' && result.toLowerCase().includes('challenges'));
                });
                if (hasMotivations) {
                    checks.push("‚úÖ Motivations int√©gr√©es");
                } else {
                    checks.push("‚ùå Motivations manquantes");
                }
            } else {
                checks.push("‚úÖ Motivations non requises");
            }
            
            // V√©rifier les r√©alisations s√©lectionn√©es
            if (testCase.formData.achievements) {
                const achievements = testCase.formData.achievements.split(',').map(a => a.trim()).filter(a => a);
                const hasAchievements = achievements.some(achievement => {
                    const achLower = achievement.toLowerCase();
                    return result.toLowerCase().includes(achLower) ||
                           (achLower === 'projet r√©ussi' && result.toLowerCase().includes('projet')) ||
                           (achLower === 'successful project' && result.toLowerCase().includes('project'));
                });
                if (hasAchievements) {
                    checks.push("‚úÖ R√©alisations int√©gr√©es");
                } else {
                    checks.push("‚ùå R√©alisations manquantes");
                }
            } else {
                checks.push("‚úÖ R√©alisations non requises");
            }
            
            // V√©rifier l'exp√©rience s√©lectionn√©e
            if (testCase.formData.experience) {
                const experiences = testCase.formData.experience.split(',').map(e => e.trim()).filter(e => e);
                const hasExperience = experiences.some(exp => {
                    const expLower = exp.toLowerCase();
                    return result.toLowerCase().includes(expLower) ||
                           (expLower === 'stage' && result.toLowerCase().includes('stage')) ||
                           (expLower === 'internship' && result.toLowerCase().includes('internship'));
                });
                if (hasExperience) {
                    checks.push("‚úÖ Exp√©rience int√©gr√©e");
                } else {
                    checks.push("‚ùå Exp√©rience manquante");
                }
            } else {
                checks.push("‚úÖ Exp√©rience non requise");
            }
            
            // V√©rifier les qualifications s√©lectionn√©es
            if (testCase.formData.qualifications) {
                const qualifications = testCase.formData.qualifications.split(',').map(q => q.trim()).filter(q => q);
                const hasQualifications = qualifications.some(qual => {
                    const qualLower = qual.toLowerCase();
                    return result.toLowerCase().includes(qualLower) ||
                           (qualLower === 'dipl√¥me' && result.toLowerCase().includes('dipl√¥me')) ||
                           (qualLower === 'degree' && result.toLowerCase().includes('degree'));
                });
                if (hasQualifications) {
                    checks.push("‚úÖ Qualifications int√©gr√©es");
                } else {
                    checks.push("‚ùå Qualifications manquantes");
                }
            } else {
                checks.push("‚úÖ Qualifications non requises");
            }
            
            // V√©rifier les accords de genre (pour le fran√ßais)
            if (testCase.language === 'fr' && testCase.gender) {
                if (testCase.gender === 'female') {
                    if (result.includes('passionn√©e') || result.includes('motiv√©e') || result.includes('convaincue') || result.includes('ravie')) {
                        checks.push("‚úÖ Accords de genre f√©minin corrects");
                    } else {
                        checks.push("‚ùå Accords de genre f√©minin incorrects");
                    }
                } else if (testCase.gender === 'male') {
                    if (result.includes('passionn√©') || result.includes('motiv√©') || result.includes('convaincu') || result.includes('ravi')) {
                        checks.push("‚úÖ Accords de genre masculin corrects");
                    } else {
                        checks.push("‚ùå Accords de genre masculin incorrects");
                    }
                }
            } else {
                checks.push("‚úÖ Accords de genre non requis");
            }
            
            // V√©rifier la structure de la lettre
            const hasHeader = result.includes(testCase.formData.name.trim());
            const hasGreeting = result.includes('Madame, Monsieur,') || result.includes('Dear Hiring Manager,');
            const hasClosing = result.includes('Cordialement,') || result.includes('Sincerely,');
            
            if (hasHeader && hasGreeting && hasClosing) {
                checks.push("‚úÖ Structure de lettre correcte");
            } else {
                checks.push("‚ùå Structure de lettre incorrecte");
            }
            
            // Afficher les r√©sultats
            checks.forEach(check => console.log(check));
            
            // Compter les tests r√©ussis
            const passedChecks = checks.filter(check => check.startsWith('‚úÖ')).length;
            const totalChecks = checks.length;
            
            if (passedChecks === totalChecks) {
                console.log(`\nüéâ TEST R√âUSSI: ${passedChecks}/${totalChecks} v√©rifications pass√©es`);
                passedTests++;
            } else {
                console.log(`\n‚ö†Ô∏è  TEST PARTIEL: ${passedChecks}/${totalChecks} v√©rifications pass√©es`);
            }
            
            // Afficher un extrait de la lettre g√©n√©r√©e
            console.log("\nüìÑ Extrait de la lettre g√©n√©r√©e:");
            console.log(result.substring(0, 200) + "...");
            
        } catch (error) {
            console.log(`‚ùå ERREUR: ${error.message}`);
        }
    });
    
    // R√©sum√© final
    console.log("\n" + "=".repeat(60));
    console.log(`üìä R√âSUM√â FINAL: ${passedTests}/${totalTests} tests r√©ussis`);
    
    if (passedTests === totalTests) {
        console.log("üéâ TOUS LES TESTS SONT PASS√âS ! Le g√©n√©rateur fonctionne parfaitement.");
    } else {
        console.log(`‚ö†Ô∏è  ${totalTests - passedTests} test(s) ont √©chou√©. V√©rifiez les probl√®mes ci-dessus.`);
    }
    
    console.log("=".repeat(60));
}

// Ex√©cuter les tests
runTests(); 